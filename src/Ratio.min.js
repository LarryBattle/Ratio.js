/**
* @project Ratio.js
* @purpose Provides a Ratio(Fraction) object for Javascript. Similar to Fraction.py for Python.
* @author Larry Battle , <http://bateru.com/news/>
* @license MIT and GPL 3.0
    MIT License <http://www.opensource.org/licenses/mit-license>
    GPL v3 <http://opensource.org/licenses/GPL-3.0>
* @info Project page: <https://github.com/LarryBattle/Ratio.js/>
* @version 0.2.1, 2012.07.02
 */
var Ratio=function(a,b,alwaysReduce){if(!(this instanceof Ratio)){return new Ratio(a,b,alwaysReduce);}
this.divSign="/";this.alwaysReduce=!!alwaysReduce;this.type="";this.denominator=isNaN(""+b)?1:Math.abs(b);this.numerator=isNaN(""+a)?0:Ratio.getNumeratorWithSign(a,(b||1));if(this.denominator&&this.alwaysReduce){var arr=Ratio.reduce(this);this.numerator=arr[0];this.denominator=arr[1];}
return this;};Ratio.VERSION="0.2.1";Ratio.isNumeric=function(obj){return!isNaN(parseFloat(obj))&&isFinite(obj);};Ratio.getValueIfDefined=function(backup,value){return typeof value!=="undefined"&&value!==null?value:backup;};Ratio.gcd=function(a,b){var c;b=(+b&&+a)?+b:0;a=b?a:1;while(b){c=a%b;a=b;b=c;}
return Math.abs(a);};Ratio.getNumeratorWithSign=function(top,bottom){var x=(+top||1),y=(+bottom||1),a=""+x*y;return(/\-/.test(a.charAt(0)))?-Math.abs(+top):Math.abs(+top);};Ratio.parseDecimal=function(obj){var arr=[],parts;if(!Ratio.isNumeric(obj)){return arr;}
obj=+obj;if(/\d+\.\d+$/.test(obj)){parts=obj.toString().split(/\./);arr[1]=Math.pow(10,parts[1].length);arr[0]=Math.abs(parts[0])*arr[1]+(+parts[1]);arr[0]=(/\-/.test(parts[0]))?-arr[0]:arr[0];}else{arr=[obj,1];}
return arr;};Ratio.parseENotation=function(obj){var arr=[],top,parts;if(!Ratio.isNumeric(obj)){return arr;}
obj=+obj;if(/e/i.test(obj)){parts=obj.toString().split(/e/i);top=Ratio.parseDecimal(parts[0]);if(Math.abs(obj)<1){arr[0]=top[0];arr[1]=+(top[1]+"e"+Math.abs(+parts[1]));}else{arr[0]=+(top[0]+"e"+Math.abs(+parts[1]));arr[1]=top[1];}}else{arr=Ratio.parseDecimal(obj);}
return arr;};Ratio.parseNumber=function(obj){if(!Ratio.isNumeric(obj)){return[];}
return(/e/i.test(obj))?Ratio.parseENotation(obj):Ratio.parseDecimal(obj);};Ratio.parseToArray=function(obj){var arr=[],parts,re=/\//;if(typeof obj=="undefined"||obj===null){return arr;}
if(obj instanceof Ratio){arr[0]=Ratio.getNumeratorWithSign(obj.numerator,obj.denominator);arr[1]=Math.abs(obj.denominator);}else{if(re.test(obj)){parts=obj.split(re);arr[0]=Ratio.getNumeratorWithSign(parts[0],parts[1]);arr[1]=Math.abs(+parts[1]);}else{arr=Ratio.parseNumber(obj);}}
return arr;};Ratio.parse=function(obj,obj2){var arr=Ratio.parseToArray(obj),arr2;if(arr.length&&typeof obj2!="undefined"&&obj2!==null){arr2=Ratio.parseToArray(obj2);arr[0]*=arr2[1];arr[1]*=arr2[0];}
return new Ratio(arr[0],arr[1]);};Ratio.reduce=function(obj,obj2){obj=Ratio.parse(obj,obj2);var top=obj.numerator,bottom=obj.denominator,arr=Ratio.getRepeatProps(top/bottom);if(arr.length){top=+(arr.join(''))-+(arr[0]+""+arr[1]);bottom=Math.pow(10,arr[1].length)*(Math.pow(10,arr[2].length)-1);}
var factor=Ratio.gcd(top,bottom);return[top/factor,bottom/factor];};Ratio.getRepeatProps=function(val){val=""+(val||"");var RE1_getRepeatDecimals=/(?:[^\.]+\.\d*)(\d{2,})+(?:\1)$/,arr=[],match=RE1_getRepeatDecimals.exec(val),RE2_RE1AtEnd,RE3_RepeatingNums=/^(\d+)(?:\1)$/;if(!match){val=val.replace(/\d$/,"");match=RE1_getRepeatDecimals.exec(val);}
if(match&&1<match.length&&/\.\d{10}/.test(match[0])){match[1]=RE3_RepeatingNums.test(match[1])?RE3_RepeatingNums.exec(match[1])[1]:match[1];RE2_RE1AtEnd=new RegExp("("+match[1]+")+$");arr=val.split(/\./).concat(match[1]);arr[1]=arr[1].replace(RE2_RE1AtEnd,"");}
return arr;};Ratio.getPrimeFactors=function(num){num=Math.floor(num);var root,factors=[],x,sqrt=Math.sqrt,doLoop=1<num&&isFinite(num);while(doLoop){root=sqrt(num);x=2;if(num%x){x=3;while((num%x)&&((x+=2)<root));}
x=(x>root)?num:x;factors.push(x);doLoop=(x!=num);num/=x;}
return factors;};Ratio.getCleanENotation=function(num){num=(+num||0).toString();if(/\.\d+(0|9){8,}\d?e/.test(num)){var i=num.match(/(?:\d+\.)(\d+)(?:e.*)/)[1].replace(/(0|9)+\d$/,'').length+1;num=(+num).toPrecision(i).toString();}
return num;};Ratio.prototype.toArray=function(){return[this.numerator,this.denominator];};Ratio.prototype.valueOf=function(showValue){return(!showValue&&this.type=="string")?this.toLocaleString():(this.numerator/this.denominator);};Ratio.prototype.toLocaleString=function(){var str=""+this.numerator,val=this.valueOf(true);if(+(this.numerator)&&this.denominator!=1){str+=this.divSign+Math.abs(this.denominator);}
if(+this.denominator===0||(this.numerator%this.denominator)===0){str=val;}
return(isNaN(val)||this.type=="decimal")?val.toString():str;};Ratio.prototype.toString=function(){return""+this.numerator+this.divSign+this.denominator;};Ratio.prototype.clone=function(top,bottom,type,alwaysReduce){var func=Ratio.getValueIfDefined;top=func(this.numerator,top);bottom=func(this.denominator,bottom);alwaysReduce=func(this.alwaysReduce,alwaysReduce);var obj=new Ratio(top,bottom,alwaysReduce);obj.type=func(this.type,type);return obj;};Ratio.prototype.reduce=function(){var arr=Ratio.reduce(this.numerator,this.denominator);return this.clone(arr[0],arr[1]);};Ratio.prototype.add=function(obj,obj2){if(!(obj instanceof Ratio)||typeof obj2!=="undefined"){obj=Ratio.parse(obj,obj2);}
var x,top,bottom;if(this.denominator==obj.denominator){top=this.numerator+obj.numerator;bottom=this.denominator;}else{x=Ratio.gcd(this.denominator,obj.denominator),top=((this.numerator*obj.denominator)+(this.denominator*obj.numerator))/x,bottom=(this.denominator*obj.denominator)/x;}
return this.clone(top,bottom);};Ratio.prototype.divide=function(obj,obj2){if(!(obj instanceof Ratio)||typeof obj2!=="undefined"){obj=Ratio.parse(obj,obj2);}
return this.clone(this.numerator*obj.denominator,this.denominator*obj.numerator);};Ratio.prototype.equals=function(obj){return(this.numerator/this.denominator)==obj.valueOf();};Ratio.prototype.multiply=function(obj,obj2){if(!(obj instanceof Ratio)||typeof obj2!=="undefined"){obj=Ratio.parse(obj,obj2);}
return this.clone(this.numerator*obj.numerator,this.denominator*obj.denominator);};Ratio.prototype.subtract=function(obj,obj2){if(!(obj instanceof Ratio)||typeof obj2!=="undefined"){obj=Ratio.parse(obj,obj2);}
obj.numerator=-obj.numerator;return this.add(obj);};Ratio.prototype.descale=function(factor){return this.clone(this.numerator/factor,this.denominator/factor);};Ratio.prototype.pow=function(power){return this.clone(Math.pow(this.numerator,+power),Math.pow(this.denominator,+power));};Ratio.prototype.scale=function(factor){return this.clone(this.numerator*+factor,this.denominator*+factor);};Ratio.prototype.cleanFormat=function(){var re=/^\d+\.\d+$/;if(re.test(this.numerator)||re.test(this.denominator)){return Ratio.parse(this.numerator,this.denominator);}
var obj=this.clone();obj.numerator=Ratio.getCleanENotation(obj.numerator);obj.denominator=Ratio.getCleanENotation(obj.denominator);return obj;};Ratio.prototype.abs=function(){return this.clone(Math.abs(this.numerator));};Ratio.prototype.mod=function(){return this.clone(this.numerator%this.denominator,1);};Ratio.prototype.negate=function(){return this.clone(-this.numerator);};Ratio.prototype.isProper=function(){return Math.abs(this.numerator)<this.denominator;};Ratio.prototype.findX=function(str){var arr=(""+str).split("/");if(arr.length!==2){return null;}
var numIndex=!isNaN(arr[0])?0:1,funcName=numIndex?"multiply":"divide";return Ratio(arr[numIndex])[funcName](this);};if(typeof exports!=='undefined'){if(typeof module!=='undefined'&&module.exports){exports=module.exports;}
exports.Ratio=Ratio;}