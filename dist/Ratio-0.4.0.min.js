/*Ratio.js by Larry Battle*/var Ratio=function(){"use strict";var t=function(e,i,n){if(!(this instanceof t))return new t(e,i,n);this.divSign="/",this.alwaysReduce=!!n;var r=t.getStandardRatioArray(e,i,this.alwaysReduce);return this._n=r[0],this._d=r[1],this};return t.MAX_PRECISION=(1/3).toString().length-2,t.MAX_VALUE=Math.pow(2,53),t.MIN_VALUE=-Math.pow(2,53),t.regex={divSignCheck:/(\d|Infinity)\s*\//,divSignSplit:/\//,cleanFormat:/^\d+\.\d+$/,mixedNumbers:/(\S+)\s+(\S[\w\W]*)/,repeatingDecimals:/[^\.]+\.\d*(\d{2,})+(?:\1)$/,repeatingNumbers:/^(\d+)(?:\1)$/},t.VERSION="0.4.0",t.isNumeric=function(t){return!isNaN(parseFloat(t))&&isFinite(t)},t.getValueIfDefined=function(t,e){return"undefined"!=typeof e&&null!==e?e:t},t.gcd=function(t,e){var i;for(e=+e&&+t?+e:0,t=e?t:1;e;)i=t%e,t=e,e=i;return Math.abs(t)},t.getNumeratorWithSign=function(t,e){var i=0>+t*(+e||1)?-1:1;return Math.abs(+t)*i},t.guessType=function(e){var i="NaN";return e instanceof t?i="Ratio":isNaN(e)?t.regex.divSignCheck.test(e)&&(i=/\d\s+[+\-]?\d/.test(e)?"mixed":"fraction"):(i="number",-1<(+e).toString().indexOf("e")?i="e":e%1&&(i="decimal")),i},t.parseToArray=function(e){var i,n,r,a=[],s=[];switch(t.guessType(e)){case"mixed":a=e.match(t.regex.mixedNumbers),s=t.parseToArray(a[2]),i=+a[1]<0||+s[0]<0?-1:1,s[0]=i*(Math.abs(s[0])+Math.abs(a[1]*s[1]));break;case"fraction":a=e.split(t.regex.divSignSplit),s[0]=t.getNumeratorWithSign(a[0],a[1]),s[1]=Math.abs(+a[1]);break;case"decimal":a=(+e).toString().split("."),s[1]=Math.pow(10,a[1].length),s[0]=Math.abs(a[0])*s[1]+ +a[1],s[0]=-1<a[0].indexOf("-")?-s[0]:s[0];break;case"number":s=[+e,1];break;case"e":a=(+e).toString().split(/e/i),r=t.parseToArray(a[0]),n=Math.abs(+e)<1?[0,1]:[1,0],s[n[0]]=r[n[0]],s[n[1]]=Number(r[n[1]]+"e"+Math.abs(+a[1]));break;case"Ratio":s=[e._n,e._d];break;default:s=[0/0,1]}return s},t.parse=function(e,i){var n,r=t.parseToArray(e);return r.length&&void 0!==i&&null!==i&&(n=t.parseToArray(i),r[0]*=n[1],r[1]*=n[0]),new t(r[0],r[1])},t.simplify=function(e,i){e=t.parse(e,i);var n,r=e._n,a=r||!e._d?e._d:1,s=t.getRepeatProps(r/a);return s.length&&(r=Number(s.join(""))-Number(s[0]+String(s[1])),a=Math.pow(10,s[1].length)*(Math.pow(10,s[2].length)-1)),n=t.gcd(r,a),[r/n,a/n]},t.getRepeatProps=function(e){e=String(e||"");var i,n=[],r=t.regex.repeatingDecimals.exec(e),a=t.regex.repeatingNumbers;return r||(e=e.replace(/\d$/,""),r=t.regex.repeatingDecimals.exec(e)),r&&1<r.length&&/\.\d{10}/.test(r[0])&&(r[1]=a.test(r[1])?a.exec(r[1])[1]:r[1],i=new RegExp("("+r[1]+")+$"),n=e.split(/\./).concat(r[1]),n[1]=n[1].replace(i,"")),n},t.getPrimeFactors=function(t){t=Math.floor(t);for(var e,i,n=[],r=Math.sqrt,a=t>1&&isFinite(t);a;){if(e=r(t),i=2,t%i)for(i=3;t%i&&(i+=2)<e;);i=i>e?t:i,n.push(i),a=i!==t,t/=i}return n},t.getCleanENotation=function(t){if(t=(+t||0).toString(),/\.\d+(0|9){8,}\d?e/.test(t)){var e=t.match(/(?:\d+\.)(\d+)(?:e[\w\W]*)/)[1].replace(/(0|9)+\d$/,"").length+1;t=(+t).toPrecision(e).toString()}return t},t.simplifyENotation=function(t,e){var i=t/e,n=/[eE]/;if(!isNaN(i)&&n.test(t)&&n.test(e)){var r=t.toString().split("e"),a=e.toString().split("e");Number(a[1])<Number(r[1])?(r[1]=Number(r[1])+-1*a[1],a[1]=0):(a[1]=Number(a[1])+-1*r[1],r[1]=0),t=Number(r.join("e")),e=Number(a.join("e"))}return[t,e]},t.getCombinedRatio=function(e,i){return e instanceof t&&void 0===i||(e=t.parse(e,i)),e},t.random=function(){var e=Math.random().toFixed(Math.floor(16*Math.random()));return t.parse(e).simplify()},t.getStandardRatioArray=function(e,i,n){"undefined"==typeof i&&(i=1,"undefined"==typeof e&&(e=0));var r=+Math.abs(i),a=t.getNumeratorWithSign(e,i||1),s=[a,r];return s[1]&&n&&(s=t.simplify(s[0],s[1])),s},t.prototype={constructor:t,numerator:function(e){return"undefined"!=typeof e&&(this._n=t.parse(e).valueOf()),this._n},denominator:function(e){return"undefined"!=typeof e&&(this._d=t.parse(e).valueOf(),this.correctRatio()),this._d},correctRatio:function(){var e=t.getStandardRatioArray(this._n,this._d,this.alwaysReduce);return this._n=e[0],this._d=e[1],this},toArray:function(){return[this._n,this._d]},valueOf:function(){var e=t.simplifyENotation(this._n,this._d);return e[0]/e[1]},toLocaleString:function(){var t,e,i=this.valueOf();return isNaN(i)?e="NaN":i%1!==0&&1!==this._d&&isFinite(i%1)?1<Math.abs(i)?(t=parseInt(i,10),e=t+" "+Math.abs(this._n%this._d)+String(this.divSign)+this._d):e=this._n+String(this.divSign)+this._d:e=String(i),e},toString:function(){return String(this._n+this.divSign+this._d)},clone:function(e,i,n){var r=t.getValueIfDefined;return e=r(this._n,e),i=r(this._d,i),n=r(this.alwaysReduce,n),new t(e,i,n)},isNaN:function(){return!t.isNumeric(this.valueOf())},simplify:function(){var e=t.simplify(this._n,this._d);return this.clone(e[0],e[1])},add:function(e,i){e=t.getCombinedRatio(e,i);var n,r,a;return this._d===e._d?(r=this._n+e._n,a=this._d):(n=t.gcd(this._d,e._d),r=(this._n*e._d+this._d*e._n)/n,a=this._d*e._d/n),this.clone(r,a)},divide:function(e,i){return e=t.getCombinedRatio(e,i),this.clone(this._n*e._d,this._d*e._n)},equals:function(e){var i=t.isNumeric(e)||e instanceof t?e.valueOf():t.parse(e).valueOf();return this._n/this._d===+i},deepEquals:function(e){return e instanceof t&&this._n===e._n&&this._d===e._d&&this.divSign===e.divSign&&this.alwaysReduce===e.alwaysReduce},multiply:function(e,i){return e=t.getCombinedRatio(e,i),this.clone(this._n*e._n,this._d*e._d)},subtract:function(e,i){e=t.getCombinedRatio(e,i);var n,r,a;return this._d===e._d?(r=this._n-e._n,a=this._d):(n=t.gcd(this._d,e._d),r=(this._n*e._d-this._d*e._n)/n,a=this._d*e._d/n),this.clone(r,a)},descale:function(e,i){var n=t.getCombinedRatio(e,i);return this.clone(this._n/n,this._d/n)},pow:function(e,i){var n=t.getCombinedRatio(e,i);return this.clone(Math.pow(this._n,+n),Math.pow(this._d,+n))},scale:function(e,i){var n=t.getCombinedRatio(e,i);return this.clone(this._n*+n,this._d*+n)},cleanFormat:function(){var e,i=t.regex.cleanFormat;return i.test(this._n)||i.test(this._d)?t.parse(this._n,this._d):(e=this.clone(),e._n=t.getCleanENotation(e._n),e._d=t.getCleanENotation(e._d),e)},abs:function(){return this.clone(Math.abs(this._n))},mod:function(){return this.clone(this._n%this._d,1)},negate:function(){return this.clone(-this._n)},isProper:function(){return Math.abs(this._n)<this._d},findX:function(e){var i=String(e).split("/");return 2!==i.length||!isNaN(i[0])&&!isNaN(i[1])?null:isNaN(i[0])?new t(i[1]).multiply(this):new t(i[0]).divide(this)},reciprocal:function(){return this.clone(this._d,this._n)},toQuantityOf:function(){var t,e,i,n=this.valueOf(),r=1/0,a=arguments.length;for(i=0;a>i;i+=1)e=Math.abs(Math.round(n*arguments[i])/arguments[i]-n),r>e&&(t=arguments[i],r=e);return this.clone(Math.round(n*t),t)},floor:function(){return this.clone(Math.floor(this.valueOf()),1)},ceil:function(){return this.clone(Math.ceil(this.valueOf()),1)},makeProper:function(){return this.clone(this._n%this._d,this._d)}},t}();"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=Ratio),exports.Ratio=Ratio):this.Ratio=Ratio;